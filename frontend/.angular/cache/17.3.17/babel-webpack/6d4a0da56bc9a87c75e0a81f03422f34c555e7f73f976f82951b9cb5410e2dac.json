{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.baseUrl = environment.apiUrl;\n    const storedUser = localStorage.getItem(environment.userKey);\n    this.currentUserSubject = new BehaviorSubject(storedUser ? JSON.parse(storedUser) : null);\n    this.currentUser = this.currentUserSubject.asObservable();\n  }\n  get currentUserValue() {\n    return this.currentUserSubject.value;\n  }\n  /**\n   * 登录 - 支持两种调用方式\n   */\n  login(emailOrRequest, password) {\n    let loginData;\n    // 判断是对象还是分开的参数\n    if (typeof emailOrRequest === 'string' && password) {\n      loginData = {\n        email: emailOrRequest,\n        password\n      };\n    } else if (typeof emailOrRequest === 'object') {\n      loginData = emailOrRequest;\n    } else {\n      throw new Error('Invalid login parameters');\n    }\n    return this.http.post(`${this.baseUrl}/auth/login`, loginData).pipe(tap(response => {\n      // 保存 token\n      localStorage.setItem(environment.tokenKey, response.token);\n      // 保存用户信息\n      const user = {\n        id: response.userId,\n        email: response.email,\n        firstName: response.firstName,\n        lastName: response.lastName\n      };\n      localStorage.setItem(environment.userKey, JSON.stringify(user));\n      this.currentUserSubject.next(user);\n    }));\n  }\n  /**\n   * 注册\n   */\n  register(data) {\n    return this.http.post(`${this.baseUrl}/auth/register`, data).pipe(tap(response => {\n      // 注册成功后自动登录\n      localStorage.setItem(environment.tokenKey, response.token);\n      const user = {\n        id: response.userId,\n        email: response.email,\n        firstName: response.firstName,\n        lastName: response.lastName\n      };\n      localStorage.setItem(environment.userKey, JSON.stringify(user));\n      this.currentUserSubject.next(user);\n    }));\n  }\n  /**\n   * 登出\n   */\n  logout() {\n    localStorage.removeItem(environment.tokenKey);\n    localStorage.removeItem(environment.userKey);\n    this.currentUserSubject.next(null);\n    this.router.navigate(['/auth/login']);\n  }\n  /**\n   * 获取 Token\n   */\n  getToken() {\n    return localStorage.getItem(environment.tokenKey);\n  }\n  /**\n   * 检查是否已登录\n   */\n  isLoggedIn() {\n    return !!this.getToken();\n  }\n  /**\n   * 获取当前用户信息\n   */\n  getCurrentUser() {\n    return this.http.get(`${this.baseUrl}/auth/me`);\n  }\n  /**\n   * 修改密码\n   */\n  changePassword(oldPassword, newPassword) {\n    return this.http.put(`${this.baseUrl}/auth/password`, {\n      oldPassword,\n      newPassword\n    });\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","tap","environment","AuthService","constructor","http","router","baseUrl","apiUrl","storedUser","localStorage","getItem","userKey","currentUserSubject","JSON","parse","currentUser","asObservable","currentUserValue","value","login","emailOrRequest","password","loginData","email","Error","post","pipe","response","setItem","tokenKey","token","user","id","userId","firstName","lastName","stringify","next","register","data","logout","removeItem","navigate","getToken","isLoggedIn","getCurrentUser","get","changePassword","oldPassword","newPassword","put","i0","ɵɵinject","i1","HttpClient","i2","Router","factory","ɵfac","providedIn"],"sources":["D:\\code\\PersonalMoneyFlow\\frontend\\src\\app\\core\\auth\\auth.service.ts"],"sourcesContent":["// auth.service.ts - 认证服务（修复版）\nimport { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { map, tap } from 'rxjs/operators';\nimport { Router } from '@angular/router';\nimport { environment } from '../../../environments/environment';\n\nexport interface LoginRequest {\n  email: string;\n  password: string;\n}\n\nexport interface RegisterRequest {\n  email: string;\n  password: string;\n  firstName: string;\n  lastName: string;\n}\n\nexport interface AuthResponse {\n  token: string;\n  type: string;\n  userId: number;\n  email: string;\n  firstName: string;\n  lastName: string;\n}\n\nexport interface User {\n  id: number;\n  email: string;\n  firstName: string;\n  lastName: string;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private baseUrl = environment.apiUrl;\n  private currentUserSubject: BehaviorSubject<User | null>;\n  public currentUser: Observable<User | null>;\n\n  constructor(\n    private http: HttpClient,\n    private router: Router\n  ) {\n    const storedUser = localStorage.getItem(environment.userKey);\n    this.currentUserSubject = new BehaviorSubject<User | null>(\n      storedUser ? JSON.parse(storedUser) : null\n    );\n    this.currentUser = this.currentUserSubject.asObservable();\n  }\n\n  public get currentUserValue(): User | null {\n    return this.currentUserSubject.value;\n  }\n\n  /**\n   * 登录 - 支持两种调用方式\n   */\n  login(emailOrRequest: string | LoginRequest, password?: string): Observable<AuthResponse> {\n    let loginData: LoginRequest;\n    \n    // 判断是对象还是分开的参数\n    if (typeof emailOrRequest === 'string' && password) {\n      loginData = { email: emailOrRequest, password };\n    } else if (typeof emailOrRequest === 'object') {\n      loginData = emailOrRequest;\n    } else {\n      throw new Error('Invalid login parameters');\n    }\n\n    return this.http.post<AuthResponse>(`${this.baseUrl}/auth/login`, loginData)\n      .pipe(\n        tap(response => {\n          // 保存 token\n          localStorage.setItem(environment.tokenKey, response.token);\n          \n          // 保存用户信息\n          const user: User = {\n            id: response.userId,\n            email: response.email,\n            firstName: response.firstName,\n            lastName: response.lastName\n          };\n          localStorage.setItem(environment.userKey, JSON.stringify(user));\n          this.currentUserSubject.next(user);\n        })\n      );\n  }\n\n  /**\n   * 注册\n   */\n  register(data: RegisterRequest): Observable<AuthResponse> {\n    return this.http.post<AuthResponse>(`${this.baseUrl}/auth/register`, data)\n      .pipe(\n        tap(response => {\n          // 注册成功后自动登录\n          localStorage.setItem(environment.tokenKey, response.token);\n          \n          const user: User = {\n            id: response.userId,\n            email: response.email,\n            firstName: response.firstName,\n            lastName: response.lastName\n          };\n          localStorage.setItem(environment.userKey, JSON.stringify(user));\n          this.currentUserSubject.next(user);\n        })\n      );\n  }\n\n  /**\n   * 登出\n   */\n  logout(): void {\n    localStorage.removeItem(environment.tokenKey);\n    localStorage.removeItem(environment.userKey);\n    this.currentUserSubject.next(null);\n    this.router.navigate(['/auth/login']);\n  }\n\n  /**\n   * 获取 Token\n   */\n  getToken(): string | null {\n    return localStorage.getItem(environment.tokenKey);\n  }\n\n  /**\n   * 检查是否已登录\n   */\n  isLoggedIn(): boolean {\n    return !!this.getToken();\n  }\n\n  /**\n   * 获取当前用户信息\n   */\n  getCurrentUser(): Observable<User> {\n    return this.http.get<User>(`${this.baseUrl}/auth/me`);\n  }\n\n  /**\n   * 修改密码\n   */\n  changePassword(oldPassword: string, newPassword: string): Observable<any> {\n    return this.http.put(`${this.baseUrl}/auth/password`, {\n      oldPassword,\n      newPassword\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}